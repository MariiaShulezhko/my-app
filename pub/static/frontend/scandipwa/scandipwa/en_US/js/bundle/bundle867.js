require.config({"config": {
        "jsbuild":{"Magento_Tinymce3/tiny_mce/plugins/media/editor_plugin_src.js":"/**\n * editor_plugin_src.js\n *\n * Copyright 2009, Moxiecode Systems AB\n * Released under LGPL License.\n *\n * License: http://tinymce.moxiecode.com/license\n * Contributing: http://tinymce.moxiecode.com/contributing\n */\n\n(function() {\n\tvar rootAttributes = tinymce.explode('id,name,width,height,style,align,class,hspace,vspace,bgcolor,type'), excludedAttrs = tinymce.makeMap(rootAttributes.join(',')), Node = tinymce.html.Node,\n\t\tmediaTypes, scriptRegExp, JSON = tinymce.util.JSON, mimeTypes;\n\n\t// Media types supported by this plugin\n\tmediaTypes = [\n\t\t// Type, clsid:s, mime types, codebase\n\t\t[\"Flash\", \"d27cdb6e-ae6d-11cf-96b8-444553540000\", \"application/x-shockwave-flash\", \"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0\"],\n\t\t[\"ShockWave\", \"166b1bca-3f9c-11cf-8075-444553540000\", \"application/x-director\", \"http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0\"],\n\t\t[\"WindowsMedia\", \"6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a\", \"application/x-mplayer2\", \"http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701\"],\n\t\t[\"QuickTime\", \"02bf25d5-8c17-4b23-bc80-d3488abddc6b\", \"video/quicktime\", \"http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0\"],\n\t\t[\"RealMedia\", \"cfcdaa03-8be4-11cf-b84b-0020afbbccfa\", \"audio/x-pn-realaudio-plugin\", \"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0\"],\n\t\t[\"Java\", \"8ad9c840-044e-11d1-b3e9-00805f499d93\", \"application/x-java-applet\", \"http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0\"],\n\t\t[\"Silverlight\", \"dfeaf541-f3e1-4c24-acac-99c30715084a\", \"application/x-silverlight-2\"],\n\t\t[\"Iframe\"],\n\t\t[\"Video\"],\n\t\t[\"EmbeddedAudio\"],\n\t\t[\"Audio\"]\n\t];\n\n\tfunction toArray(obj) {\n\t\tvar undef, out, i;\n\n\t\tif (obj && !obj.splice) {\n\t\t\tout = [];\n\n\t\t\tfor (i = 0; true; i++) {\n\t\t\t\tif (obj[i])\n\t\t\t\t\tout[i] = obj[i];\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\treturn out;\n\t\t}\n\n\t\treturn obj;\n\t};\n\n\ttinymce.create('tinymce.plugins.MediaPlugin', {\n\t\tinit : function(ed, url) {\n\t\t\tvar self = this, lookup = {}, i, y, item, name;\n\n\t\t\tfunction isMediaImg(node) {\n\t\t\t\treturn node && node.nodeName === 'IMG' && ed.dom.hasClass(node, 'mceItemMedia');\n\t\t\t};\n\n\t\t\tself.editor = ed;\n\t\t\tself.url = url;\n\n\t\t\t// Parse media types into a lookup table\n\t\t\tscriptRegExp = '';\n\t\t\tfor (i = 0; i < mediaTypes.length; i++) {\n\t\t\t\tname = mediaTypes[i][0];\n\n\t\t\t\titem = {\n\t\t\t\t\tname : name,\n\t\t\t\t\tclsids : tinymce.explode(mediaTypes[i][1] || ''),\n\t\t\t\t\tmimes : tinymce.explode(mediaTypes[i][2] || ''),\n\t\t\t\t\tcodebase : mediaTypes[i][3]\n\t\t\t\t};\n\n\t\t\t\tfor (y = 0; y < item.clsids.length; y++)\n\t\t\t\t\tlookup['clsid:' + item.clsids[y]] = item;\n\n\t\t\t\tfor (y = 0; y < item.mimes.length; y++)\n\t\t\t\t\tlookup[item.mimes[y]] = item;\n\n\t\t\t\tlookup['mceItem' + name] = item;\n\t\t\t\tlookup[name.toLowerCase()] = item;\n\n\t\t\t\tscriptRegExp += (scriptRegExp ? '|' : '') + name;\n\t\t\t}\n\n\t\t\t// Handle the media_types setting\n\t\t\ttinymce.each(ed.getParam(\"media_types\",\n\t\t\t\t\"video=mp4,m4v,ogv,webm;\" +\n\t\t\t\t\"silverlight=xap;\" +\n\t\t\t\t\"flash=swf,flv;\" +\n\t\t\t\t\"shockwave=dcr;\" +\n\t\t\t\t\"quicktime=mov,qt,mpg,mpeg;\" +\n\t\t\t\t\"shockwave=dcr;\" +\n\t\t\t\t\"windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;\" +\n\t\t\t\t\"realmedia=rm,ra,ram;\" +\n\t\t\t\t\"java=jar;\" +\n\t\t\t\t\"audio=mp3,ogg\"\n\t\t\t).split(';'), function(item) {\n\t\t\t\tvar i, extensions, type;\n\n\t\t\t\titem = item.split(/=/);\n\t\t\t\textensions = tinymce.explode(item[1].toLowerCase());\n\t\t\t\tfor (i = 0; i < extensions.length; i++) {\n\t\t\t\t\ttype = lookup[item[0].toLowerCase()];\n\n\t\t\t\t\tif (type)\n\t\t\t\t\t\tlookup[extensions[i]] = type;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tscriptRegExp = new RegExp('write(' + scriptRegExp + ')\\\\(([^)]+)\\\\)');\n\t\t\tself.lookup = lookup;\n\n\t\t\ted.onPreInit.add(function() {\n\t\t\t\t// Allow video elements\n\t\t\t\ted.schema.addValidElements('object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]');\n\n\t\t\t\t// Convert video elements to image placeholder\n\t\t\t\ted.parser.addNodeFilter('object,embed,video,audio,script,iframe', function(nodes) {\n\t\t\t\t\tvar i = nodes.length;\n\n\t\t\t\t\twhile (i--)\n\t\t\t\t\t\tself.objectToImg(nodes[i]);\n\t\t\t\t});\n\n\t\t\t\t// Convert image placeholders to video elements\n\t\t\t\ted.serializer.addNodeFilter('img', function(nodes, name, args) {\n\t\t\t\t\tvar i = nodes.length, node;\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tnode = nodes[i];\n\t\t\t\t\t\tif ((node.attr('class') || '').indexOf('mceItemMedia') !== -1)\n\t\t\t\t\t\t\tself.imgToObject(node, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\ted.onInit.add(function() {\n\t\t\t\t// Display \"media\" instead of \"img\" in element path\n\t\t\t\tif (ed.theme && ed.theme.onResolveName) {\n\t\t\t\t\ted.theme.onResolveName.add(function(theme, path_object) {\n\t\t\t\t\t\tif (path_object.name === 'img' && ed.dom.hasClass(path_object.node, 'mceItemMedia'))\n\t\t\t\t\t\t\tpath_object.name = 'media';\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Add contect menu if it's loaded\n\t\t\t\tif (ed && ed.plugins.contextmenu) {\n\t\t\t\t\ted.plugins.contextmenu.onContextMenu.add(function(plugin, menu, element) {\n\t\t\t\t\t\tif (element.nodeName === 'IMG' && element.className.indexOf('mceItemMedia') !== -1)\n\t\t\t\t\t\t\tmenu.add({title : 'media.edit', icon : 'media', cmd : 'mceMedia'});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Register commands\n\t\t\ted.addCommand('mceMedia', function() {\n\t\t\t\tvar data, img;\n\n\t\t\t\timg = ed.selection.getNode();\n\t\t\t\tif (isMediaImg(img)) {\n\t\t\t\t\tdata = ed.dom.getAttrib(img, 'data-mce-json');\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tdata = JSON.parse(data);\n\n\t\t\t\t\t\t// Add some extra properties to the data object\n\t\t\t\t\t\ttinymce.each(rootAttributes, function(name) {\n\t\t\t\t\t\t\tvar value = ed.dom.getAttrib(img, name);\n\n\t\t\t\t\t\t\tif (value)\n\t\t\t\t\t\t\t\tdata[name] = value;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tdata.type = self.getType(img.className).name.toLowerCase();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!data) {\n\t\t\t\t\tdata = {\n\t\t\t\t\t\ttype : 'flash',\n\t\t\t\t\t\tvideo: {sources:[]},\n\t\t\t\t\t\tparams: {}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\ted.windowManager.open({\n\t\t\t\t\tfile : url + '/media.htm',\n\t\t\t\t\twidth : 430 + parseInt(ed.getLang('media.delta_width', 0)),\n\t\t\t\t\theight : 500 + parseInt(ed.getLang('media.delta_height', 0)),\n\t\t\t\t\tinline : 1\n\t\t\t\t}, {\n\t\t\t\t\tplugin_url : url,\n\t\t\t\t\tdata : data\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Register buttons\n\t\t\ted.addButton('media', {title : 'media.desc', cmd : 'mceMedia'});\n\n\t\t\t// Update media selection status\n\t\t\ted.onNodeChange.add(function(ed, cm, node) {\n\t\t\t\tcm.setActive('media', isMediaImg(node));\n\t\t\t});\n\t\t},\n\n\t\tconvertUrl : function(url, force_absolute) {\n\t\t\tvar self = this, editor = self.editor, settings = editor.settings,\n\t\t\t\turlConverter = settings.url_converter,\n\t\t\t\turlConverterScope = settings.url_converter_scope || self;\n\n\t\t\tif (!url)\n\t\t\t\treturn url;\n\n\t\t\tif (force_absolute)\n\t\t\t\treturn editor.documentBaseURI.toAbsolute(url);\n\n\t\t\treturn urlConverter.call(urlConverterScope, url, 'src', 'object');\n\t\t},\n\n\t\tgetInfo : function() {\n\t\t\treturn {\n\t\t\t\tlongname : 'Media',\n\t\t\t\tauthor : 'Moxiecode Systems AB',\n\t\t\t\tauthorurl : 'http://tinymce.moxiecode.com',\n\t\t\t\tinfourl : 'http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media',\n\t\t\t\tversion : tinymce.majorVersion + \".\" + tinymce.minorVersion\n\t\t\t};\n\t\t},\n\n\t\t/**\n\t\t * Converts the JSON data object to an img node.\n\t\t */\n\t\tdataToImg : function(data, force_absolute) {\n\t\t\tvar self = this, editor = self.editor, baseUri = editor.documentBaseURI, sources, attrs, img, i;\n\n\t\t\tdata.params.src = self.convertUrl(data.params.src, force_absolute);\n\n\t\t\tattrs = data.video.attrs;\n\t\t\tif (attrs)\n\t\t\t\tattrs.src = self.convertUrl(attrs.src, force_absolute);\n\n\t\t\tif (attrs)\n\t\t\t\tattrs.poster = self.convertUrl(attrs.poster, force_absolute);\n\n\t\t\tsources = toArray(data.video.sources);\n\t\t\tif (sources) {\n\t\t\t\tfor (i = 0; i < sources.length; i++)\n\t\t\t\t\tsources[i].src = self.convertUrl(sources[i].src, force_absolute);\n\t\t\t}\n\n\t\t\timg = self.editor.dom.create('img', {\n\t\t\t\tid : data.id,\n\t\t\t\tstyle : data.style,\n\t\t\t\talign : data.align,\n\t\t\t\thspace : data.hspace,\n\t\t\t\tvspace : data.vspace,\n\t\t\t\tsrc : self.editor.theme.url + '/img/trans.gif',\n\t\t\t\t'class' : 'mceItemMedia mceItem' + self.getType(data.type).name,\n\t\t\t\t'data-mce-json' : JSON.serialize(data)\n\t\t\t});\n\n\t\t\timg.width = data.width || (data.type == 'audio' ? \"300\" : \"320\");\n\t\t\timg.height = data.height || (data.type == 'audio' ? \"32\" : \"240\");\n\n\t\t\treturn img;\n\t\t},\n\n\t\t/**\n\t\t * Converts the JSON data object to a HTML string.\n\t\t */\n\t\tdataToHtml : function(data, force_absolute) {\n\t\t\treturn this.editor.serializer.serialize(this.dataToImg(data, force_absolute), {forced_root_block : '', force_absolute : force_absolute});\n\t\t},\n\n\t\t/**\n\t\t * Converts the JSON data object to a HTML string.\n\t\t */\n\t\thtmlToData : function(html) {\n\t\t\tvar fragment, img, data;\n\n\t\t\tdata = {\n\t\t\t\ttype : 'flash',\n\t\t\t\tvideo: {sources:[]},\n\t\t\t\tparams: {}\n\t\t\t};\n\n\t\t\tfragment = this.editor.parser.parse(html);\n\t\t\timg = fragment.getAll('img')[0];\n\n\t\t\tif (img) {\n\t\t\t\tdata = JSON.parse(img.attr('data-mce-json'));\n\t\t\t\tdata.type = this.getType(img.attr('class')).name.toLowerCase();\n\n\t\t\t\t// Add some extra properties to the data object\n\t\t\t\ttinymce.each(rootAttributes, function(name) {\n\t\t\t\t\tvar value = img.attr(name);\n\n\t\t\t\t\tif (value)\n\t\t\t\t\t\tdata[name] = value;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\n\t\t/**\n\t\t * Get type item by extension, class, clsid or mime type.\n\t\t *\n\t\t * @method getType\n\t\t * @param {String} value Value to get type item by.\n\t\t * @return {Object} Type item object or undefined.\n\t\t */\n\t\tgetType : function(value) {\n\t\t\tvar i, values, typeItem;\n\n\t\t\t// Find type by checking the classes\n\t\t\tvalues = tinymce.explode(value, ' ');\n\t\t\tfor (i = 0; i < values.length; i++) {\n\t\t\t\ttypeItem = this.lookup[values[i]];\n\n\t\t\t\tif (typeItem)\n\t\t\t\t\treturn typeItem;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Converts a tinymce.html.Node image element to video/object/embed.\n\t\t */\n\t\timgToObject : function(node, args) {\n\t\t\tvar self = this, editor = self.editor, video, object, embed, iframe, name, value, data,\n\t\t\t\tsource, sources, params, param, typeItem, i, item, mp4Source, replacement,\n\t\t\t\tposterSrc, style, audio;\n\n\t\t\t// Adds the flash player\n\t\t\tfunction addPlayer(video_src, poster_src) {\n\t\t\t\tvar baseUri, flashVars, flashVarsOutput, params, flashPlayer;\n\n\t\t\t\tflashPlayer = editor.getParam('flash_video_player_url', self.convertUrl(self.url + '/moxieplayer.swf'));\n\t\t\t\tif (flashPlayer) {\n\t\t\t\t\tbaseUri = editor.documentBaseURI;\n\t\t\t\t\tdata.params.src = flashPlayer;\n\n\t\t\t\t\t// Convert the movie url to absolute urls\n\t\t\t\t\tif (editor.getParam('flash_video_player_absvideourl', true)) {\n\t\t\t\t\t\tvideo_src = baseUri.toAbsolute(video_src || '', true);\n\t\t\t\t\t\tposter_src = baseUri.toAbsolute(poster_src || '', true);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Generate flash vars\n\t\t\t\t\tflashVarsOutput = '';\n\t\t\t\t\tflashVars = editor.getParam('flash_video_player_flashvars', {url : '$url', poster : '$poster'});\n\t\t\t\t\ttinymce.each(flashVars, function(value, name) {\n\t\t\t\t\t\t// Replace $url and $poster variables in flashvars value\n\t\t\t\t\t\tvalue = value.replace(/\\$url/, video_src || '');\n\t\t\t\t\t\tvalue = value.replace(/\\$poster/, poster_src || '');\n\n\t\t\t\t\t\tif (value.length > 0)\n\t\t\t\t\t\t\tflashVarsOutput += (flashVarsOutput ? '&' : '') + name + '=' + escape(value);\n\t\t\t\t\t});\n\n\t\t\t\t\tif (flashVarsOutput.length)\n\t\t\t\t\t\tdata.params.flashvars = flashVarsOutput;\n\n\t\t\t\t\tparams = editor.getParam('flash_video_player_params', {\n\t\t\t\t\t\tallowfullscreen: true,\n\t\t\t\t\t\tallowscriptaccess: true\n\t\t\t\t\t});\n\n\t\t\t\t\ttinymce.each(params, function(value, name) {\n\t\t\t\t\t\tdata.params[name] = \"\" + value;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tdata = node.attr('data-mce-json');\n\t\t\tif (!data)\n\t\t\t\treturn;\n\n\t\t\tdata = JSON.parse(data);\n\t\t\ttypeItem = this.getType(node.attr('class'));\n\n\t\t\tstyle = node.attr('data-mce-style')\n\t\t\tif (!style) {\n\t\t\t\tstyle = node.attr('style');\n\n\t\t\t\tif (style)\n\t\t\t\t\tstyle = editor.dom.serializeStyle(editor.dom.parseStyle(style, 'img'));\n\t\t\t}\n\n\t\t\t// Handle iframe\n\t\t\tif (typeItem.name === 'Iframe') {\n\t\t\t\treplacement = new Node('iframe', 1);\n\n\t\t\t\ttinymce.each(rootAttributes, function(name) {\n\t\t\t\t\tvar value = node.attr(name);\n\n\t\t\t\t\tif (name == 'class' && value)\n\t\t\t\t\t\tvalue = value.replace(/mceItem.+ ?/g, '');\n\n\t\t\t\t\tif (value && value.length > 0)\n\t\t\t\t\t\treplacement.attr(name, value);\n\t\t\t\t});\n\n\t\t\t\tfor (name in data.params)\n\t\t\t\t\treplacement.attr(name, data.params[name]);\n\n\t\t\t\treplacement.attr({\n\t\t\t\t\tstyle: style,\n\t\t\t\t\tsrc: data.params.src\n\t\t\t\t});\n\n\t\t\t\tnode.replace(replacement);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Handle scripts\n\t\t\tif (this.editor.settings.media_use_script) {\n\t\t\t\treplacement = new Node('script', 1).attr('type', 'text/javascript');\n\n\t\t\t\tvalue = new Node('#text', 3);\n\t\t\t\tvalue.value = 'write' + typeItem.name + '(' + JSON.serialize(tinymce.extend(data.params, {\n\t\t\t\t\twidth: node.attr('width'),\n\t\t\t\t\theight: node.attr('height')\n\t\t\t\t})) + ');';\n\n\t\t\t\treplacement.append(value);\n\t\t\t\tnode.replace(replacement);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Add HTML5 video element\n\t\t\tif (typeItem.name === 'Video' && data.video.sources[0]) {\n\t\t\t\t// Create new object element\n\t\t\t\tvideo = new Node('video', 1).attr(tinymce.extend({\n\t\t\t\t\tid : node.attr('id'),\n\t\t\t\t\twidth: node.attr('width'),\n\t\t\t\t\theight: node.attr('height'),\n\t\t\t\t\tstyle : style\n\t\t\t\t}, data.video.attrs));\n\n\t\t\t\t// Get poster source and use that for flash fallback\n\t\t\t\tif (data.video.attrs)\n\t\t\t\t\tposterSrc = data.video.attrs.poster;\n\n\t\t\t\tsources = data.video.sources = toArray(data.video.sources);\n\t\t\t\tfor (i = 0; i < sources.length; i++) {\n\t\t\t\t\tif (/\\.mp4$/.test(sources[i].src))\n\t\t\t\t\t\tmp4Source = sources[i].src;\n\t\t\t\t}\n\n\t\t\t\tif (!sources[0].type) {\n\t\t\t\t\tvideo.attr('src', sources[0].src);\n\t\t\t\t\tsources.splice(0, 1);\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < sources.length; i++) {\n\t\t\t\t\tsource = new Node('source', 1).attr(sources[i]);\n\t\t\t\t\tsource.shortEnded = true;\n\t\t\t\t\tvideo.append(source);\n\t\t\t\t}\n\n\t\t\t\t// Create flash fallback for video if we have a mp4 source\n\t\t\t\tif (mp4Source) {\n\t\t\t\t\taddPlayer(mp4Source, posterSrc);\n\t\t\t\t\ttypeItem = self.getType('flash');\n\t\t\t\t} else\n\t\t\t\t\tdata.params.src = '';\n\t\t\t}\n\n\t\t\t// Add HTML5 audio element\n\t\t\tif (typeItem.name === 'Audio' && data.video.sources[0]) {\n\t\t\t\t// Create new object element\n\t\t\t\taudio = new Node('audio', 1).attr(tinymce.extend({\n\t\t\t\t\tid : node.attr('id'),\n\t\t\t\t\twidth: node.attr('width'),\n\t\t\t\t\theight: node.attr('height'),\n\t\t\t\t\tstyle : style\n\t\t\t\t}, data.video.attrs));\n\n\t\t\t\t// Get poster source and use that for flash fallback\n\t\t\t\tif (data.video.attrs)\n\t\t\t\t\tposterSrc = data.video.attrs.poster;\n\n\t\t\t\tsources = data.video.sources = toArray(data.video.sources);\n\t\t\t\tif (!sources[0].type) {\n\t\t\t\t\taudio.attr('src', sources[0].src);\n\t\t\t\t\tsources.splice(0, 1);\n\t\t\t\t}\n\n\t\t\t\tfor (i = 0; i < sources.length; i++) {\n\t\t\t\t\tsource = new Node('source', 1).attr(sources[i]);\n\t\t\t\t\tsource.shortEnded = true;\n\t\t\t\t\taudio.append(source);\n\t\t\t\t}\n\n\t\t\t\tdata.params.src = '';\n\t\t\t}\n\n\t\t\tif (typeItem.name === 'EmbeddedAudio') {\n\t\t\t\tembed = new Node('embed', 1);\n\t\t\t\tembed.shortEnded = true;\n\t\t\t\tembed.attr({\n\t\t\t\t\tid: node.attr('id'),\n\t\t\t\t\twidth: node.attr('width'),\n\t\t\t\t\theight: node.attr('height'),\n\t\t\t\t\tstyle : style,\n\t\t\t\t\ttype: node.attr('type')\n\t\t\t\t});\n\n\t\t\t\tfor (name in data.params)\n\t\t\t\t\tembed.attr(name, data.params[name]);\n\n\t\t\t\ttinymce.each(rootAttributes, function(name) {\n\t\t\t\t\tif (data[name] && name != 'type')\n\t\t\t\t\t\tembed.attr(name, data[name]);\n\t\t\t\t});\n\n\t\t\t\tdata.params.src = '';\n\t\t\t}\n\n\t\t\t// Do we have a params src then we can generate object\n\t\t\tif (data.params.src) {\n\t\t\t\t// Is flv movie add player for it\n\t\t\t\tif (/\\.flv$/i.test(data.params.src))\n\t\t\t\t\taddPlayer(data.params.src, '');\n\n\t\t\t\tif (args && args.force_absolute)\n\t\t\t\t\tdata.params.src = editor.documentBaseURI.toAbsolute(data.params.src);\n\n\t\t\t\t// Create new object element\n\t\t\t\tobject = new Node('object', 1).attr({\n\t\t\t\t\tid : node.attr('id'),\n\t\t\t\t\twidth: node.attr('width'),\n\t\t\t\t\theight: node.attr('height'),\n\t\t\t\t\tstyle : style\n\t\t\t\t});\n\n\t\t\t\ttinymce.each(rootAttributes, function(name) {\n\t\t\t\t\tvar value = data[name];\n\n\t\t\t\t\tif (name == 'class' && value)\n\t\t\t\t\t\tvalue = value.replace(/mceItem.+ ?/g, '');\n\n\t\t\t\t\tif (value && name != 'type')\n\t\t\t\t\t\tobject.attr(name, value);\n\t\t\t\t});\n\n\t\t\t\t// Add params\n\t\t\t\tfor (name in data.params) {\n\t\t\t\t\tparam = new Node('param', 1);\n\t\t\t\t\tparam.shortEnded = true;\n\t\t\t\t\tvalue = data.params[name];\n\n\t\t\t\t\t// Windows media needs to use url instead of src for the media URL\n\t\t\t\t\tif (name === 'src' && typeItem.name === 'WindowsMedia')\n\t\t\t\t\t\tname = 'url';\n\n\t\t\t\t\tparam.attr({name: name, value: value});\n\t\t\t\t\tobject.append(param);\n\t\t\t\t}\n\n\t\t\t\t// Setup add type and classid if strict is disabled\n\t\t\t\tif (this.editor.getParam('media_strict', true)) {\n\t\t\t\t\tobject.attr({\n\t\t\t\t\t\tdata: data.params.src,\n\t\t\t\t\t\ttype: typeItem.mimes[0]\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tobject.attr({\n\t\t\t\t\t\tclassid: \"clsid:\" + typeItem.clsids[0],\n\t\t\t\t\t\tcodebase: typeItem.codebase\n\t\t\t\t\t});\n\n\t\t\t\t\tembed = new Node('embed', 1);\n\t\t\t\t\tembed.shortEnded = true;\n\t\t\t\t\tembed.attr({\n\t\t\t\t\t\tid: node.attr('id'),\n\t\t\t\t\t\twidth: node.attr('width'),\n\t\t\t\t\t\theight: node.attr('height'),\n\t\t\t\t\t\tstyle : style,\n\t\t\t\t\t\ttype: typeItem.mimes[0]\n\t\t\t\t\t});\n\n\t\t\t\t\tfor (name in data.params)\n\t\t\t\t\t\tembed.attr(name, data.params[name]);\n\n\t\t\t\t\ttinymce.each(rootAttributes, function(name) {\n\t\t\t\t\t\tif (data[name] && name != 'type')\n\t\t\t\t\t\t\tembed.attr(name, data[name]);\n\t\t\t\t\t});\n\n\t\t\t\t\tobject.append(embed);\n\t\t\t\t}\n\n\t\t\t\t// Insert raw HTML\n\t\t\t\tif (data.object_html) {\n\t\t\t\t\tvalue = new Node('#text', 3);\n\t\t\t\t\tvalue.raw = true;\n\t\t\t\t\tvalue.value = data.object_html;\n\t\t\t\t\tobject.append(value);\n\t\t\t\t}\n\n\t\t\t\t// Append object to video element if it exists\n\t\t\t\tif (video)\n\t\t\t\t\tvideo.append(object);\n\t\t\t}\n\n\t\t\tif (video) {\n\t\t\t\t// Insert raw HTML\n\t\t\t\tif (data.video_html) {\n\t\t\t\t\tvalue = new Node('#text', 3);\n\t\t\t\t\tvalue.raw = true;\n\t\t\t\t\tvalue.value = data.video_html;\n\t\t\t\t\tvideo.append(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (audio) {\n\t\t\t\t// Insert raw HTML\n\t\t\t\tif (data.video_html) {\n\t\t\t\t\tvalue = new Node('#text', 3);\n\t\t\t\t\tvalue.raw = true;\n\t\t\t\t\tvalue.value = data.video_html;\n\t\t\t\t\taudio.append(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar n = video || audio || object || embed;\n\t\t\tif (n)\n\t\t\t\tnode.replace(n);\n\t\t\telse\n\t\t\t\tnode.remove();\n\t\t},\n\n\t\t/**\n\t\t * Converts a tinymce.html.Node video/object/embed to an img element.\n\t\t *\n\t\t * The video/object/embed will be converted into an image placeholder with a JSON data attribute like this:\n\t\t * <img class=\"mceItemMedia mceItemFlash\" width=\"100\" height=\"100\" data-mce-json=\"{..}\" />\n\t\t *\n\t\t * The JSON structure will be like this:\n\t\t * {'params':{'flashvars':'something','quality':'high','src':'someurl'}, 'video':{'sources':[{src: 'someurl', type: 'video/mp4'}]}}\n\t\t */\n\t\tobjectToImg : function(node) {\n\t\t\tvar object, embed, video, iframe, img, name, id, width, height, style, i, html,\n\t\t\t\tparam, params, source, sources, data, type, lookup = this.lookup,\n\t\t\t\tmatches, attrs, urlConverter = this.editor.settings.url_converter,\n\t\t\t\turlConverterScope = this.editor.settings.url_converter_scope,\n\t\t\t\thspace, vspace, align, bgcolor;\n\n\t\t\tfunction getInnerHTML(node) {\n\t\t\t\treturn new tinymce.html.Serializer({\n\t\t\t\t\tinner: true,\n\t\t\t\t\tvalidate: false\n\t\t\t\t}).serialize(node);\n\t\t\t};\n\n\t\t\tfunction lookupAttribute(o, attr) {\n\t\t\t\treturn lookup[(o.attr(attr) || '').toLowerCase()];\n\t\t\t}\n\n\t\t\tfunction lookupExtension(src) {\n\t\t\t\tvar ext = src.replace(/^.*\\.([^.]+)$/, '$1');\n\t\t\t\treturn lookup[ext.toLowerCase() || ''];\n\t\t\t}\n\n\t\t\t// If node isn't in document\n\t\t\tif (!node.parent)\n\t\t\t\treturn;\n\n\t\t\t// Handle media scripts\n\t\t\tif (node.name === 'script') {\n\t\t\t\tif (node.firstChild)\n\t\t\t\t\tmatches = scriptRegExp.exec(node.firstChild.value);\n\n\t\t\t\tif (!matches)\n\t\t\t\t\treturn;\n\n\t\t\t\ttype = matches[1];\n\t\t\t\tdata = {video : {}, params : JSON.parse(matches[2])};\n\t\t\t\twidth = data.params.width;\n\t\t\t\theight = data.params.height;\n\t\t\t}\n\n\t\t\t// Setup data objects\n\t\t\tdata = data || {\n\t\t\t\tvideo : {},\n\t\t\t\tparams : {}\n\t\t\t};\n\n\t\t\t// Setup new image object\n\t\t\timg = new Node('img', 1);\n\t\t\timg.attr({\n\t\t\t\tsrc : this.editor.theme.url + '/img/trans.gif'\n\t\t\t});\n\n\t\t\t// Video element\n\t\t\tname = node.name;\n\t\t\tif (name === 'video' || name == 'audio') {\n\t\t\t\tvideo = node;\n\t\t\t\tobject = node.getAll('object')[0];\n\t\t\t\tembed = node.getAll('embed')[0];\n\t\t\t\twidth = video.attr('width');\n\t\t\t\theight = video.attr('height');\n\t\t\t\tid = video.attr('id');\n\t\t\t\tdata.video = {attrs : {}, sources : []};\n\n\t\t\t\t// Get all video attributes\n\t\t\t\tattrs = data.video.attrs;\n\t\t\t\tfor (name in video.attributes.map)\n\t\t\t\t\tattrs[name] = video.attributes.map[name];\n\n\t\t\t\tsource = node.attr('src');\n\t\t\t\tif (source)\n\t\t\t\t\tdata.video.sources.push({src : urlConverter.call(urlConverterScope, source, 'src', node.name)});\n\n\t\t\t\t// Get all sources\n\t\t\t\tsources = video.getAll(\"source\");\n\t\t\t\tfor (i = 0; i < sources.length; i++) {\n\t\t\t\t\tsource = sources[i].remove();\n\n\t\t\t\t\tdata.video.sources.push({\n\t\t\t\t\t\tsrc: urlConverter.call(urlConverterScope, source.attr('src'), 'src', 'source'),\n\t\t\t\t\t\ttype: source.attr('type'),\n\t\t\t\t\t\tmedia: source.attr('media')\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Convert the poster URL\n\t\t\t\tif (attrs.poster)\n\t\t\t\t\tattrs.poster = urlConverter.call(urlConverterScope, attrs.poster, 'poster', node.name);\n\t\t\t}\n\n\t\t\t// Object element\n\t\t\tif (node.name === 'object') {\n\t\t\t\tobject = node;\n\t\t\t\tembed = node.getAll('embed')[0];\n\t\t\t}\n\n\t\t\t// Embed element\n\t\t\tif (node.name === 'embed')\n\t\t\t\tembed = node;\n\n\t\t\t// Iframe element\n\t\t\tif (node.name === 'iframe') {\n\t\t\t\tiframe = node;\n\t\t\t\ttype = 'Iframe';\n\t\t\t}\n\n\t\t\tif (object) {\n\t\t\t\t// Get width/height\n\t\t\t\twidth = width || object.attr('width');\n\t\t\t\theight = height || object.attr('height');\n\t\t\t\tstyle = style || object.attr('style');\n\t\t\t\tid = id || object.attr('id');\n\t\t\t\thspace = hspace || object.attr('hspace');\n\t\t\t\tvspace = vspace || object.attr('vspace');\n\t\t\t\talign = align || object.attr('align');\n\t\t\t\tbgcolor = bgcolor || object.attr('bgcolor');\n\t\t\t\tdata.name = object.attr('name');\n\n\t\t\t\t// Get all object params\n\t\t\t\tparams = object.getAll(\"param\");\n\t\t\t\tfor (i = 0; i < params.length; i++) {\n\t\t\t\t\tparam = params[i];\n\t\t\t\t\tname = param.remove().attr('name');\n\n\t\t\t\t\tif (!excludedAttrs[name])\n\t\t\t\t\t\tdata.params[name] = param.attr('value');\n\t\t\t\t}\n\n\t\t\t\tdata.params.src = data.params.src || object.attr('data');\n\t\t\t}\n\n\t\t\tif (embed) {\n\t\t\t\t// Get width/height\n\t\t\t\twidth = width || embed.attr('width');\n\t\t\t\theight = height || embed.attr('height');\n\t\t\t\tstyle = style || embed.attr('style');\n\t\t\t\tid = id || embed.attr('id');\n\t\t\t\thspace = hspace || embed.attr('hspace');\n\t\t\t\tvspace = vspace || embed.attr('vspace');\n\t\t\t\talign = align || embed.attr('align');\n\t\t\t\tbgcolor = bgcolor || embed.attr('bgcolor');\n\n\t\t\t\t// Get all embed attributes\n\t\t\t\tfor (name in embed.attributes.map) {\n\t\t\t\t\tif (!excludedAttrs[name] && !data.params[name])\n\t\t\t\t\t\tdata.params[name] = embed.attributes.map[name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (iframe) {\n\t\t\t\t// Get width/height\n\t\t\t\twidth = iframe.attr('width');\n\t\t\t\theight = iframe.attr('height');\n\t\t\t\tstyle = style || iframe.attr('style');\n\t\t\t\tid = iframe.attr('id');\n\t\t\t\thspace = iframe.attr('hspace');\n\t\t\t\tvspace = iframe.attr('vspace');\n\t\t\t\talign = iframe.attr('align');\n\t\t\t\tbgcolor = iframe.attr('bgcolor');\n\n\t\t\t\ttinymce.each(rootAttributes, function(name) {\n\t\t\t\t\timg.attr(name, iframe.attr(name));\n\t\t\t\t});\n\n\t\t\t\t// Get all iframe attributes\n\t\t\t\tfor (name in iframe.attributes.map) {\n\t\t\t\t\tif (!excludedAttrs[name] && !data.params[name])\n\t\t\t\t\t\tdata.params[name] = iframe.attributes.map[name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Use src not movie\n\t\t\tif (data.params.movie) {\n\t\t\t\tdata.params.src = data.params.src || data.params.movie;\n\t\t\t\tdelete data.params.movie;\n\t\t\t}\n\n\t\t\t// Convert the URL to relative/absolute depending on configuration\n\t\t\tif (data.params.src)\n\t\t\t\tdata.params.src = urlConverter.call(urlConverterScope, data.params.src, 'src', 'object');\n\n\t\t\tif (video) {\n\t\t\t\tif (node.name === 'video')\n\t\t\t\t\ttype = lookup.video.name;\n\t\t\t\telse if (node.name === 'audio')\n\t\t\t\t\ttype = lookup.audio.name;\n\t\t\t}\n\n\t\t\tif (object && !type)\n\t\t\t\ttype = (lookupAttribute(object, 'clsid') || lookupAttribute(object, 'classid') || lookupAttribute(object, 'type') || {}).name;\n\n\t\t\tif (embed && !type)\n\t\t\t\ttype = (lookupAttribute(embed, 'type') || lookupExtension(data.params.src) || {}).name;\n\n\t\t\t// for embedded audio we preserve the original specified type\n\t\t\tif (embed && type == 'EmbeddedAudio') {\n\t\t\t\tdata.params.type = embed.attr('type');\n\t\t\t}\n\n\t\t\t// Replace the video/object/embed element with a placeholder image containing the data\n\t\t\tnode.replace(img);\n\n\t\t\t// Remove embed\n\t\t\tif (embed)\n\t\t\t\tembed.remove();\n\n\t\t\t// Serialize the inner HTML of the object element\n\t\t\tif (object) {\n\t\t\t\thtml = getInnerHTML(object.remove());\n\n\t\t\t\tif (html)\n\t\t\t\t\tdata.object_html = html;\n\t\t\t}\n\n\t\t\t// Serialize the inner HTML of the video element\n\t\t\tif (video) {\n\t\t\t\thtml = getInnerHTML(video.remove());\n\n\t\t\t\tif (html)\n\t\t\t\t\tdata.video_html = html;\n\t\t\t}\n\n\t\t\tdata.hspace = hspace;\n\t\t\tdata.vspace = vspace;\n\t\t\tdata.align = align;\n\t\t\tdata.bgcolor = bgcolor;\n\n\t\t\t// Set width/height of placeholder\n\t\t\timg.attr({\n\t\t\t\tid : id,\n\t\t\t\t'class' : 'mceItemMedia mceItem' + (type || 'Flash'),\n\t\t\t\tstyle : style,\n\t\t\t\twidth : width || (node.name == 'audio' ? \"300\" : \"320\"),\n\t\t\t\theight : height || (node.name == 'audio' ? \"32\" : \"240\"),\n\t\t\t\thspace : hspace,\n\t\t\t\tvspace : vspace,\n\t\t\t\talign : align,\n\t\t\t\tbgcolor : bgcolor,\n\t\t\t\t\"data-mce-json\" : JSON.serialize(data)\n\t\t\t});\n\t\t}\n\t});\n\n\t// Register plugin\n\ttinymce.PluginManager.add('media', tinymce.plugins.MediaPlugin);\n})();\n"}
}});
